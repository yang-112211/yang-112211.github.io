
// Initialize modal flyout
function flyoutFormController(button, form_result) {

    $(button).click(function (e) {
        e.preventDefault();
        $(form_result).addClass('slide-in--open');
        $('body').addClass('noscroll');
        $('.overlay').addClass('active');
    });

    $('.close-form, .overlay').click(function (e) {
        $('.overlay').removeClass('active');
        e.preventDefault();
        $('.slide-in').removeClass('slide-in--open'); // toggle out all forms
        $('body').removeClass('noscroll');
    })
}

// Search placeholder
$('.keyword-search-wrapper .form-item input').attr('placeholder','Enter your search...');

// Open wallpaper links in Views in a new tab
$('.download a').attr("download", "");

// Keyword search function
$(".header__search--trigger").click(function (e) {
    e.preventDefault();
    $('.keyword-search-wrapper').slideToggle();
});

// Custom JS script
$(document).ready(function () {

    if ($(window).width() < 450) {
        var accordionTrigger = $('.accordion__trigger');
        var accordionContent = $('.accordion__content');

        accordionContent.slideUp().addClass('accUp');
    
        accordionTrigger.click(function (e) {
            e.preventDefault();
            if ($(this).hasClass('accordion__trigger--active')) {
                $(this).removeClass('accordion__trigger--active').removeClass('accDwn').addClass('accUp').addClass('accUp');
                $(this).siblings(accordionContent).slideUp().removeClass('accDwn').addClass('accUp').addClass('accUp'); 
            } else if (accordionTrigger.hasClass('accordion__trigger--active')) {
                accordionTrigger.removeClass('accordion__trigger--active').removeClass('accDwn').addClass('accUp');
                accordionTrigger.siblings(accordionContent).slideUp().removeClass('accDwn').addClass('accUp');
                $(this).addClass('accordion__trigger--active').removeClass('accUp').addClass('accDwn');
                $(this).siblings(accordionContent).slideDown().removeClass('accUp').addClass('accDwn');
            } else {
                accordionTrigger.removeClass('accordion__trigger--active').removeClass('accDwn').addClass('accUp');
                accordionTrigger.siblings(accordionContent).slideUp().removeClass('accDwn').addClass('accUp');
                $(this).addClass('accordion__trigger--active').removeClass('accUp').addClass('accDwn');
                $(this).siblings(accordionContent).slideDown().removeClass('accUp').addClass('accDwn');
            }
        });
    }

    $('#mytime').click(function (e) {
        e.preventDefault();
        $('#tab-mytime').show();
        $('#tab-tracktime').hide();
        $('#mytime').addClass('active');
        $('#tracktime').removeClass('active');
    });

    $('#tracktime').click(function (e) {
        e.preventDefault();
        $('#tab-mytime').hide();
        $('#tab-tracktime').show();
        $('#tracktime').addClass('active');
        $('#mytime').removeClass('active');
    });

    // Localise the times
    // end active pending - active also goes on wrapper
    if ($('.timings').length) {
        var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        $('#tab-mytime .session-detail').each(function () {
            $trackDate = new Date(($(this).find('.date').data('date') + 3600 - $('#tabs').data('time-difference')) * 1000);
// console.log($trackDate);
            $(this).find('.date').html('<strong>' + ('0' + $trackDate.getDate()).slice(-2) + ' ' + months[$trackDate.getMonth()] + '</strong>');
            $trackTimeStart = new Date(($(this).find('.times').data('time-start') + 3600 - $('#tabs').data('time-difference')) * 1000);
            $trackTime = ('0' + $trackTimeStart.getHours()).slice(-2) + ':' + ('0' + $trackTimeStart.getMinutes()).slice(-2);
            if ($(this).find('.times').data('time-end')) {
                $trackTimeEnd = new Date(($(this).find('.times').data('time-end') + 3600 - $('#tabs').data('time-difference')) * 1000);
                $trackTime = $trackTime + ' - ' + ('0' + $trackTimeEnd.getHours()).slice(-2) + ':' + ('0' + $trackTimeEnd.getMinutes()).slice(-2);
            }
            $(this).find('.times').text($trackTime);
        });
    }

    // Careers modal
    if ($('body').hasClass('node-7857')) {
        $('body').addClass('noscroll');
        $('a#consent').on('click', function (e) {
            e.preventDefault();
            $('.modal').addClass('consented');
            $('body').removeClass('noscroll');
        });
    }

    $('.countdown-container-0').each(function () {
        var deadline = $(this).data('deadline');
        $(this).find('.days').countdown(deadline, function (event) {
            $(this).html(event.strftime('%D'));
        });
        $(this).find('.hours').countdown(deadline, function (event) {
            $(this).html(event.strftime('%H'));
        });
        $(this).find('.mins').countdown(deadline, function (event) {
            $(this).html(event.strftime('%M'));
        });
        $(this).find('.secs').countdown(deadline, function (event) {
            $(this).html(event.strftime('%S'));
        });
    });

    // Initialize homepage Grid
    // var $grid = $('.grid').masonry({
    //     columnWidth: '.grid-sizer',
    //     itemSelector: '.grid__item',
    //     gutter: '.gutter-sizer',
    //     percentPosition: true,
    //     transitionDuration: '0.8s',
    //     stagger: 30
    // });

    // $grid.imagesLoaded().progress(function () {
    //     $grid.masonry('layout');
    // });

    var $grid = $('.grid');

    $grid.imagesLoaded(function(){
        $grid.masonry({
            columnWidth: '.grid-sizer',
            itemSelector: '.grid__item',
            gutter: '.gutter-sizer',
            percentPosition: true,
            transitionDuration: '0.8s',
            stagger: 30,
            setGallerySize: false
        });
    });

    $grid.imagesLoaded().progress(function () {
        $grid.masonry('layout');
    });

    flyoutFormController('.flyout_button', '.registration');

    // Read more content
    $('.more-content').addClass('hide');

    $('.more-toggle').on('click', function () {
        $(this).prev('.more-content').fadeToggle('hide');
        [this.dataset.textSwap, this.textContent] = [this.textContent, this.dataset.textSwap];
    });

});
